<body>
    <div id="player"></div>
    <!-- add buttons for all four directions using unicode arrow characters as the button text -->
    <button id="up-button" class="arrowButton">&#x2191;</button>
    <button id="down-button" class="arrowButton">&#x2193;</button>
    <button id="left-button" class="arrowButton">&#x2190;</button>
    <button id="right-button" class="arrowButton">&#x2192;</button>
    <!-- add an image called background-image -->
    <img id="background-image" src="images/map.gif">
</body>
<script lang="text/javascript">
    // create a variable for moveDistance
    const moveDistance = 32;
    
    // create a variable for the x and y position of the background-image
    let x = 0;
    let y = 0;

    // create a function that sets the background-image's position based from the center of the screen and offset by the x and y variables

    function tryMove(inx, iny) {
        newX = x + inx;
        newY = y + iny;

        if (checkCollision(newX, newY)) {
            return;
        }

        x = newX;
        y = newY;
        moveTo(x, y);
    }

    // create a moveTo function that takes in an x and y position and moves the background-image to that position
    function moveTo(inX,inY)
    {
        x = inX;
        y = inY;
        // move the background-image
        document.getElementById("background-image").style.transform = `translate(${-x*moveDistance}px, ${y*moveDistance}px)`;
    }

    // add event listeners to each button that call the appropriate function
    document.getElementById("up-button").addEventListener("click", () => tryMove(0, 1));
    document.getElementById("down-button").addEventListener("click", () => tryMove(0, -1));
    document.getElementById("left-button").addEventListener("click", () => tryMove(-1, 0));
    document.getElementById("right-button").addEventListener("click", () => tryMove(1, 0));

    // add event listeners for the keyboard arrow keys that call the appropriate function
    document.addEventListener("keydown", (e) => {
        switch (e.key) {
            case "ArrowUp":
                tryMove(0, 1);
                break;
            case "ArrowDown":
                tryMove(0, -1);
                break;
            case "ArrowLeft":
                tryMove(-1, 0);
                break;
            case "ArrowRight":
                tryMove(1, 0);
                break;
        }
    });

function findBlackPixelsInImage() {
  // Create an image element
  const img = new Image();

    // Set the src of the image to start loading it
    img.src = "images/collision-map.png";

  // Set the onload function to extract pixel data once the image has loaded
  img.onload = function() {
    // Create a canvas element
    const canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;

    // Get the 2D context of the canvas
    const ctx = canvas.getContext('2d');

    // Draw the image onto the canvas
    ctx.drawImage(img, 0, 0);

    // Get the pixel data of the canvas
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // Loop through the pixels and find the black ones
    const blackPixels = [];
    for (let y = 0; y < canvas.height; y++) {
      for (let x = 0; x < canvas.width; x++) {
        const index = (y * canvas.width + x) * 4; // Each pixel has 4 values: red, green, blue, and alpha
        const red = imageData.data[index];
        const green = imageData.data[index + 1];
        const blue = imageData.data[index + 2];
        const alpha = imageData.data[index + 3];

        if (red === 0 && green === 0 && blue === 0 && alpha === 255) { // Check if the pixel is black
          blackPixels.push({x, y}); // Add the coordinate to the list of black pixels
        }
      }
    }

    console.log(blackPixels);
    return blackPixels;
  };
}

var collisionMap = findBlackPixelsInImage();

function checkCollision(x, y) {
    for (var i = 0; i < collisionMap.length; i++) {
        if (collisionMap[i].x == x && collisionMap[i].y == y) {
            return true;
        }
    }
    return false;
}

// create a variable for the starting position
    const startingPosition = {x: 6, y: -6};
    // "spawn"
    moveTo(startingPosition.x, startingPosition.y);
</script>
<style>
    :root {
        --buttonDistance: 20px;
    }
    body {
        background-color: white;
        font-family: Arial, Helvetica, sans-serif;
        /* prevent scrollbars when moving map outside bounds */
        overflow: hidden;
    }
    #background-image {
        position: absolute;
        top: 50%;
        left: 50%;
        z-index: -1;
    }
    #player {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        background-color: black;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .arrowButton {
        font-size: 14pt;
        color: black;
        background-color: transparent;
        border: none;
        outline: none;
    }
    #up-button {
        position: absolute;
        top: calc(50% - var(--buttonDistance) - 12pt);
        left: 50%;
        transform: translate(-50%, -50%);
    }
    #down-button {
        position: absolute;
        top: calc(50% + var(--buttonDistance) + 12pt);
        left: 50%;
        transform: translate(-50%, -50%);
    }
    #left-button {
        position: absolute;
        top: 50%;
        left: calc(50% - var(--buttonDistance) - 12pt);
        transform: translate(-50%, -50%);
    }
    #right-button {
        position: absolute;
        top: 50%;
        left: calc(50% + var(--buttonDistance) + 12pt);
        transform: translate(-50%, -50%);
    }
</style>
